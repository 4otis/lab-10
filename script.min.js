const titleInput=document.getElementById("artifact-title"),categoryInput=document.getElementById("artifact-category"),imageInput=document.getElementById("artifact-image"),addBtn=document.getElementById("add-btn"),gallery=document.getElementById("gallery"),searchInput=document.getElementById("search-by-category"),searchBtn=document.getElementById("search-btn"),errorBanner=document.getElementById("error-banner"),totalCounter=document.getElementById("total-counter"),categoriesTabs=document.getElementById("categories-tabs"),themeToggle=document.getElementById("theme-toggle"),modal=document.getElementById("modal"),closeModal=document.querySelector(".close-modal"),modalTitle=document.getElementById("modal-title"),modalCategory=document.getElementById("modal-category"),modalImage=document.getElementById("modal-image");let categories=[],artifacts=[];const defaultImages=["images/artifact1.jpg","images/artifact2.jpg","images/artifact3.jpg"];function init(){updateCounter(),addBtn.addEventListener("click",addArtifact),searchBtn.addEventListener("click",searchByCategory),themeToggle.addEventListener("click",toggleTheme),closeModal.addEventListener("click",()=>modal.classList.add("hidden")),modal.addEventListener("click",e=>{e.target===modal&&modal.classList.add("hidden")})}function addArtifact(){if(!titleInput.value.trim()||!categoryInput.value.trim()){errorBanner.classList.remove("hidden");return}errorBanner.classList.add("hidden");let e=imageInput.value.trim();if(!e){let t=Math.floor(Math.random()*defaultImages.length);e=defaultImages[t]}let a={id:Date.now(),title:titleInput.value.trim(),category:categoryInput.value.trim(),image:e,isFavourite:!1,createdAt:new Date().toLocaleString()};artifacts.push(a),createCard(a),categories.includes(a.category)||(categories.push(a.category),createTab(a.category)),titleInput.value="",categoryInput.value="",imageInput.value="",updateCounter()}function createCard(e){let t=document.createElement("div");t.classList.add("card"),t.dataset.id=e.id,t.dataset.category=e.category.toLowerCase();let a=document.createElement("h2");a.textContent=e.title;let l=document.createElement("p");l.textContent=`Категория: ${e.category}`;let o=document.createElement("img");o.src=e.image,o.alt=e.title,o.loading="lazy";let r=document.createElement("button");r.textContent="Удалить",r.classList.add("del-btn"),r.addEventListener("click",a=>{a.stopPropagation(),t.remove(),artifacts=artifacts.filter(t=>t.id!==e.id),updateCounter(),checkCategories()});let n=document.createElement("button");n.textContent=e.isFavourite?"★ В избранном":"☆ В избранное",n.classList.add("secondary"),n.addEventListener("click",a=>{a.stopPropagation(),e.isFavourite=!e.isFavourite,n.textContent=e.isFavourite?"★ В избранном":"☆ В избранное",e.isFavourite?t.classList.add("favourite"):t.classList.remove("favourite")}),t.appendChild(a),t.appendChild(l),t.appendChild(o),t.appendChild(n),t.appendChild(r),t.addEventListener("click",()=>{openModal(e)}),gallery.appendChild(t)}function createTab(e){let t=document.createElement("button");t.classList.add("tab"),t.textContent=e,t.dataset.category=e.toLowerCase(),t.addEventListener("click",()=>{document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active")),t.classList.add("active");let e=document.querySelectorAll(".card");e.forEach(e=>{"all"===t.dataset.category?e.style.display="block":e.dataset.category===t.dataset.category?e.style.display="block":e.style.display="none"})}),categoriesTabs.appendChild(t)}function checkCategories(){let e=new Set(artifacts.map(e=>e.category));document.querySelectorAll(".tab").forEach(t=>{"all"===t.dataset.category||e.has(t.textContent)||t.remove()}),categories=Array.from(e)}function searchByCategory(){let e=searchInput.value.toLowerCase().trim(),t=document.querySelectorAll(".card");t.forEach(t=>{""===e?t.style.display="block":t.dataset.category.includes(e)?t.style.display="block":t.style.display="none"}),searchInput.value=""}function updateCounter(){totalCounter.textContent=artifacts.length}function toggleTheme(){document.body.classList.toggle("dark-theme"),document.body.classList.toggle("light-theme"),document.body.classList.contains("dark-theme")?themeToggle.textContent="Светлая тема":themeToggle.textContent="Темная тема"}function openModal(e){modalTitle.textContent=e.title,modalCategory.textContent=`Категория: ${e.category}`,modalImage.src=e.image,modalImage.alt=e.title,modal.classList.remove("hidden")}init();